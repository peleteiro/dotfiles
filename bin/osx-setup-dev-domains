#!/bin/bash

# Configure local dns resolver for *.dev -> 127.0.0.1

# install dnsmasq
brew install dnsmasq

# configure resolver
mkdir -pv $(brew --prefix)/etc/ && \
echo 'address=/.dev/127.0.0.1' > $(brew --prefix)/etc/dnsmasq.conf && \
sudo cp -v $(brew --prefix dnsmasq)/homebrew.mxcl.dnsmasq.plist /Library/LaunchDaemons && \
sudo launchctl load -w /Library/LaunchDaemons/homebrew.mxcl.dnsmasq.plist && \
sudo mkdir -v /etc/resolver && \
sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/dev'

#flush cache
sudo dscacheutil -flushcache
sudo killall -HUP mDNSResponder
sudo scutil --dns